---
title: Clearhaus Transaction API Documentation
---

# Getting Started

You need an API key before you can interact with our API. Send an E-mail to <a href="mailto:support@clearhaus.com">support@clearhaus.com</a> to request an API key.

<p class="alert alert-danger">
API keys come with many privileges so keep them secret.
</p>

## API endpoint

````
https://gateway.clearhaus.com      # live accounts
https://gateway.test.clearhaus.com # test accounts
````


## Authentication

Authentication is done via HTTP Basic Auth. Simply provide your API key as
username and a blank string as password. Remember a colon `:` after username
when using cURL to specify an empty password.

````shell
curl https://gateway.test.clearhaus.com \
     -u <your-api-key>:
````

You will get this response when you provide an invalid API key:

````http
HTTP/1.1 401 Not Authorized
````

## Resource discovery

The API follows [HATEOAS][HATEOAS] principle of REST which means all resources
are discoverable.

```shell
curl https://gateway.test.clearhaus.com \
     -u <your-api-key>:
```

```json
{
    "_links": {
        "authorizations": { "href": "/authorizations" },
        "account":        { "href": "/account" }
    }
}
```

## Response format
All responses will be delivered in JSON format (see [JSON-HAL][JSON-HAL]).

````
Content-Type: application/vnd.clearhaus-gateway.hal+json; version=0.10.0; charset=utf-8
````

where the version follows [Semantic Versioning](http://semver.org).

We use HTTP response codes to indicate API response status:

````
Number  Text
200     OK
201     Created
400     Bad Request
401     Unauthorized
404     Not Found
5xx     Server Error
````

## Accounts and keys

There are two types of accounts:

* A merchant account belongs to a merchant.
* A partner account belongs to you, i.e. a partner being tech-wise integrated
  into the transaction API.

Merchant accounts can process transactions whereas partner accounts cannot.

An API key (UUIDv4) points to an account (either a merchant account or a partner
account). An account can have multiple API keys pointing to it; this allows for
easy rolling of API keys. A merchant account usually uses one API key.

API keys can have an expire date. API keys can be enabled or disabled. For
merchant accounts, these details can be observed in the Clearhaus Dashboard.

A partner account API key can be a signing API key, meaning that it has a
verification key for verifying request signatures. This verification key is the
public part of an RSA key pair; the RSA key pair is generated by the partner.
The public part, the verification key, is communicated to Clearhaus during the
technical integration.

Only partner accounts have signing API keys.

## Signing requests

POST requests must be signed. Other requests can optionally be signed.

The signature is an RSA signature of the HTTP body; it is represented in hex.
The partner account is identified by the partner's signing API key.
Both the partner's signing API key and the RSA signature must be provided in a
`Signature` header together with `RS256-hex`:

```
Signature: <partner-signing-api-key> RS256-hex <signature>
```

<p class="alert alert-info">
<b>Notice:</b> If the signature header is included, it must hold a correct
signature, otherwise the transaction will fail.
</p>

### RSA signature

The RSA signature is an `RSASSA-PKCS1-v1_5` signature of the body. It is
represented in hex.

If the signing API key is `4390aec7-f76a-4c2f-8597-c87c2d06cb4f`, the signing
private key (in PEM format) is

```
-----BEGIN RSA PRIVATE KEY-----
MIIBOwIBAAJBALYK0zmwuYkH3YWcFNLLddx5cwDxEY7Gi1xITuQqRrU4yD3uSw+J
WYKknb4Tbndb6iEHY+e6gIGD+49TojnNeIUCAwEAAQJARyuYRRe4kcBHdPL+mSL+
Y0IAGkAlUyKAXYXPghidKD/v/oLrFaZWALGM2clv6UoYYpPnInSgbcud4sTcfeUm
QQIhAN2JZ2qv0WGcbIopBpwpQ5jDxMGVkmkVVUEWWABGF8+pAiEA0lySxTELZm8b
Gx9UEDRghN+Qv/OuIKFldu1Ba4f8W30CIQCaQFIBtunTTVdF28r+cLzgYW9eWwbW
pEP4TdZ4WlW6AQIhAMDCTUdeUpjxlH/87BXROORozAXocBW8bvJUI486U5ctAiAd
InviQqJd1KTGRDmWIGrE5YACVmW2JSszD9t5VKxkAA==
-----END RSA PRIVATE KEY-----
```

and the body is

```
amount=2050&currency=EUR&ip=1.1.1.1&card[pan]=4111111111111111&card[expire_month]=06&card[expire_year]=2022&card[csc]=123
```

then the `Signature` header should be

```
Signature: 4390aec7-f76a-4c2f-8597-c87c2d06cb4f RS256-hex 7ae0e14d35b2a15a7ff812a1899d7f0a5d28063f0c276081876a51fc3773f499459f944f8b57c6e0e76b47c218b20ebaad7c6250dcd1804dd19c87fb7f1216ba
```

In Ruby, you can calculate the RS256 hex signature using

```
key = OpenSSL::PKey::RSA.new(key_in_pem_string)
key.sign(OpenSSL::Digest.new('sha256'), body).unpack('H*').first
```

# Examples

## Charge a cardholder

To charge a cardholder you first have to reserve money on his bank account.
Next you can transfer money from his bank account to your merchant bank
account.


### Reserve money

The following will reserve EUR 20.50 (2050 cents) on cardholder's bank account:

````shell
curl -X POST https://gateway.test.clearhaus.com/authorizations \
     -u <your-api-key>: \
     -d "amount=2050"   \
     -d "currency=EUR"  \
     -d "ip=1.1.1.1"    \
     -d "card[pan]=4111111111111111" \
     -d "card[expire_month]=06"      \
     -d "card[expire_year]=2022"     \
     -d "card[csc]=123"              \
     -H "Signature: <signing-api-key> RS256-hex <signature>"
````

Example response (snippet):

````json
{
    "id": "84412a34-fa29-4369-a098-0165a80e8fda",
    "status": {
        "code": 20000
    },
    "csc": {
        "present": true,
        "matches": true
    },
    "processed_at": "2018-07-09T12:58:56+00:00",
    "_links": {
        "captures": { "href": "/authorizations/84412a34-fa29-4369-a098-0165a80e8fda/captures" }
    }
}
````

In order to actually transfer money from cardholder's bank account to your
merchant bank account you will have to make a capture transaction.

<p class="alert alert-info">
<b>Notice:</b> Some issuers will approve authorizations although the CSC did not
match; in this case the <code>status</code> <code>code</code> will be
<code>20000</code> but <code>csc</code> <code>matches</code> will be
<code>false</code>. Please be aware that rules to disallow captures for such
authorizations may be in place for a merchant.
</p>


### Withdraw money

The following will make a capture transaction and withdraw what you have
reserved on cardholder's bank account.

````shell
curl -X POST \
  https://gateway.test.clearhaus.com/authorizations/84412a34-fa29-4369-a098-0165a80e8fda/captures \
  -u <your-api-key>: \
  -H "Signature: <signing-api-key> RS256-hex <signature>"
````

You can withdraw a partial amount by providing an `amount` parameter:

````shell
curl -X POST \
  https://gateway.test.clearhaus.com/authorizations/84412a34-fa29-4369-a098-0165a80e8fda/captures \
  -u <your-api-key>: \
  -d "amount=1000"   \
  -H "Signature: <signing-api-key> RS256-hex <signature>"
````

Example response (snippet):

````json
{
    "id": "d8e92a70-3030-4d4d-8ad2-684b230c1bed",
    "status": {
        "code": 20000
    },
    "processed_at": "2018-07-09T12:58:56+00:00",
    "amount": 1000,
    "_links": {
        "authorization": {
            "href": "/authorizations/84412a34-fa29-4369-a098-0165a80e8fda"
        },
        "refunds": {
            "href": "/authorizations/84412a34-fa29-4369-a098-0165a80e8fda/refunds"
        }
    }
}
````


## Refund to cardholder

You can refund all money or a partial amount of what you have withdrawn from
cardholder's bank account:

````shell
curl -X POST \
  https://gateway.test.clearhaus.com/authorizations/84412a34-fa29-4369-a098-0165a80e8fda/refunds \
  -u <your-api-key>: \
  -d "amount=500"    \
  -H "Signature: <signing-api-key> RS256-hex <signature>"
````

Example response (snippet):

````json
{
    "id": "f04c0872-47ce-4683-8d8c-e154221bba14",
    "status": {
        "code": 20000
    },
    "processed_at": "2018-07-09T12:58:56+00:00",
    "amount": 500,
    "_links": {
        "authorization": { "href": "/authorizations/84412a34-fa29-4369-a098-0165a80e8fda" }
    }
}
````


## Payout to cardholder

Sometimes cardholders should receive money, e.g. if you wish to pay out some
winnings.

The following will transfer EUR 500.00 to cardholder's bank account from your
merchant bank account:

````shell
curl -X POST https://gateway.test.clearhaus.com/credits \
     -u <your-api-key>: \
     -d "amount=50000"  \
     -d "currency=EUR"  \
     -d "ip=1.1.1.1"    \
     -d "card[pan]=4111111111111111" \
     -d "card[expire_month]=06"      \
     -d "card[expire_year]=2022"     \
     -H "Signature: <signing-api-key> RS256-hex <signature>"
````

Example response (snippet):

````json
{
    "id": "1b377999-bafb-42b0-a24f-106b312b0b40",
    "status": {
        "code": 20000
    },
    "processed_at": "2018-07-09T12:58:56+00:00",
    "amount": 50000,
    "currency": "EUR"
}
````

Depending on card scheme and merchant category, the name on the card might be
necessary for approval of credits. It may be provided through the optional
parameter `card[name]`.

## Recurring payments

Recurring payments enable you to repeatedly charge cardholders without having
them to provide card information for subsequent payments.

### Subscription concept

Many PSPs have a subscription concept for supporting recurring payments.
The first approved authorization is the initial recurring authorization (also
known as "first in series"), all later authorizations are called subsequent
authorizations. Clearhaus supports subscriptions in the form of recurring
payments.

### Repeatedly reserve money

A recurring payment is made by making an authorization and setting `recurring`
parameter to `true`. The first recurring payment for a given card could be made
this way (notice that the amount may be zero):

````shell
curl -X POST \
  https://gateway.test.clearhaus.com/authorizations \
  -u <your-api-key>:  \
  -d "amount=2050"    \
  -d "currency=EUR"   \
  -d "recurring=true" \
  -d "card[pan]=4111111111111111" \
  -d "card[expire_month]=06"      \
  -d "card[expire_year]=2022"     \
  -d "card[csc]=123"              \
  --data-urlencode "card[pares]=<some-pares-value>" \
  -H "Signature: <signing-api-key> RS256-hex <signature>"
````

Example response (snippet):

````json
{
    "id": "e3e9d215-6efc-4c0e-b3d7-2226057c6de8",
    "status": {
        "code": 20000
    },
    "processed_at": "2018-07-09T12:58:56+00:00",
    "recurring": true
}
````

This should be followed by a capture except when the amount is `0`.

Subsequent authorizations are made similarly, but neither CSC nor PARes (see
[3-D Secure](#3-d-secure)) would be included.

An initial recurring authorization can also be made using the `applepay` and
`mobilepayonline` payment methods; subsequent recurring payments, however, must
be made using the `card` payment method using the card details of the initial
recurring authorization.


## 3-D Secure

3-D Secure is a protocol designed to improve security for online transactions.
Before you continue please read more about this protocol at
[3dsecure.io](http://docs.3dsecure.io).

3-D Secure is the only way to achieve liability shift for fraud chargebacks.

### Secure transactions

To perform a 3-D Secure transaction you make an ordinary authorization including
a `pares` value:

````shell
curl -X POST https://gateway.test.clearhaus.com/authorizations \
     -u <your-api-key>: \
     -d "amount=2050"   \
     -d "currency=EUR"  \
     -d "ip=1.1.1.1"    \
     -d "card[pan]=4111111111111111" \
     -d "card[expire_month]=06"      \
     -d "card[expire_year]=2022"     \
     -d "card[csc]=123"              \
     --data-urlencode "card[pares]=<some-pares-value>" \
     -H "Signature: <signing-api-key> RS256-hex <signature>"
````

Example response (snippet):

````json
{
    "id": "84412a34-fa29-4369-a098-0165a80e8fda",
    "status": {
        "code": 20000
    },
    "processed_at": "2018-07-09T12:58:56+00:00",
    "threed_secure": true
}
````


## Fetch account information

Some basic account information can be fetched:

````shell
curl https://gateway.test.clearhaus.com/account \
     -u <your-api-key>:
````

Example response (snippet):

````json
{
    "merchant_id": "000000003000001",
    "name": "Merchant Ltd.",
    "country": "GB",
    "mcc": "1111",
    "descriptor": "merchant.com",
    "transaction_rules":"reject authorization if amount > 100 EUR and (not fully 3dsecure)",
    "acquirer": {
        "visa_bin": 438309,
        "mastercard_bin": 526571
    }
}
````

See [account resource](#account) documentation for further details.


# API Reference


## Resources

Our API offers six different resources:

- [Authorizations](#authorizations)
- [Captures](#captures)
- [Refunds](#refunds)
- [Voids](#voids)
- [Credits](#credits)
- [Account](#account)


### Authorizations

To reserve money on a cardholder's bank account you make a new authorization resource.

````
POST https://gateway.clearhaus.com/authorizations
````

Authorizations can be created using different payment methods:
`card`, `applepay`, `mobilepayonline`.
Exactly one payment method must be used.

#### Parameters

<dl class="dl-vertical">
  <dt>amount
    <span class="type">[0-9]{1,10}</span>
  </dt>
  <dd>
    Amount in minor units of given currency (e.g. cents if in Euro).
  </dd>
  <dt>currency
    <span class="type">[A-Z]{3}</span>
  </dt>
  <dd>
    <a target="_blank" href="currencies.txt">3-letter currency code</a>. (Some exponents differ from ISO 4217.)
  </dd>
  <dt>ip
    <span class="type">[0-9.a-fA-F:]{3,45}</span>
  </dt>
  <dd>
    Cardholder's IP address. It must be a valid v4 or v6 address.
    <div class="type">Optional<br></div>
  </dd>
  <dt>recurring
    <span class="type">(true|false)</span>
  </dt>
  <dd>
    Must be <code>true</code> for recurring payments.
    <div class="type">Optional</div>
  </dd>
  <dt>text_on_statement
    <span class="type">[\x20-\x7E]{2,22}
      <a target="_blank" href="http://en.wikipedia.org/wiki/ASCII#ASCII_printable_characters">
        ASCII printable characters
      </a>
    </span>
  </dt>
  <dd>
    Text that will be placed on cardholder's bank statement.
    <div class="type">May not be all digits, all same character, or all sequential characters (e.g. "abc")</div>
    <div class="type">Optional</div>
  </dd>
  <dt>reference
    <span class="type">[\x20-\x7E]{1,30}
      <a target="_blank" href= "http://en.wikipedia.org/wiki/ASCII#ASCII_printable_characters">
        ASCII printable characters
      </a>
    </span>
  </dt>
  <dd>
    A reference to an external object, such as an order number.
    <div class="type">Optional</div>
  </dd>
</dl>

##### Method: `card`

<dl class="dl-vertical">
  <dt>card[pan]
    <span class="type">[0-9]{12,19}</span>
  </dt>
  <dd>
    Primary account number of card to charge.
  </dd>
  <dt>card[expire_month]
    <span class="type">[0-9]{2}</span>
  </dt>
  <dd>Expiry month of card to charge.</dd>
  <dt>card[expire_year]
    <span class="type">20[0-9]{2}</span>
  </dt>
  <dd>Expiry year of card to charge.</dd>
  <dt>card[csc]
    <span class="type">[0-9]{3}</span>
  </dt>
  <dd>
    Card Security Code.
    <div class="type">Optional when partner is trusted</div>
  </dd>
  <dt>card[pares]
    <span class="type">[:base64:]</span>
  </dt>
  <dd>
    See more information at <a target="_blank" href="http://docs.3dsecure.io">3dsecure.io</a>
    <div class="type">Optional</div>
  </dd>
</dl>

<p class="alert alert-info">
  <b>Notice:</b> A valid PARes included in <code>card[pares]</code> can indicate
  3 different levels: non-authenticated, attempted 3-D Secure, fully 3-D Secure.
  <br />
  <b>Notice:</b> An authorization made with <code>card[]</code> is strongly
  authenticated if it is fully 3-D Secure.
  <br />
  <b>Notice:</b> An authorization that includes <code>card[pares]</code> and/or
  <code>card[csc]</code> cannot be a subsequent recurring authorization.
</p>

##### Method: `applepay`

Apple Pay requires the payment details (PAN, expiry, etc.) of the payment token
to be decrypted by a symmetric key.
Your systems must derive this symmetric key using the payment token's ephemeral
public key, the merchant's private key and the merchant ID. For this, we refer
to [our reference implementation](https://github.com/clearhaus/pedicel) written
in Ruby; see [Apple's documentation for the <code>PaymentToken</code>
object][ApplePay-PaymentToken] for more information.

<dl class="dl-vertical">
  <dt>applepay[payment_token]
    <span class="type">[:json:]</span>
  </dt>
  <dd>
    Full <code>PKPaymentToken</code> serialized as JSON, supplied as a string.
    <br>
    Example: <code>{"paymentData":{"version":"EC_v1","data":"<Base64>",...},"paymentMethod":{...},...}</code>
  </dd>
  <dt>applepay[symmetric_key]
    <span class="type">[:hex:]</span>
  </dt>
  <dd>
    Symmetric AES key (unique per transaction) that can decrypt
    <code>data</code> from the <code>PKPaymentToken</code>.
  </dd>
</dl>

<p class="alert alert-info">
  <b>Notice:</b> Signing is required to use the <code>applepay</code> payment
  method.
  <br />
  <b>Notice:</b> An authorization made with <code>applepay</code> is
  strongly authenticated (SCA in PSD2).
  <br />
  <b>Notice:</b> An authorization made with <code>applepay</code> may be fully
  3-D Secured, 3-D Secure attempted, or with no 3-D Secure; this is indicated by
  the <code>eciIndicator</code> of the <code>applepay[payment_token]</code>.
  <br />
  <b>Notice:</b> An authorization made with <code>applepay</code> cannot be a
  subsequent recurring authorization.
</p>

##### Method: `mobilepayonline`

<dl class="dl-vertical">
  <dt>mobilepayonline[pan]
    <span class="type">[0-9]{12,19}</span>
  </dt>
  <dd>
    Primary account number of card to charge.
  </dd>
  <dt>mobilepayonline[expire_month]
    <span class="type">[0-9]{2}</span>
  </dt>
  <dd>
    Expiry month of card to charge.
  </dd>
  <dt>mobilepayonline[expire_year]
    <span class="type">[0-9]{4}</span>
  </dt>
  <dd>
    Expiry year of card to charge.
  </dd>
  <dt>mobilepayonline[phone_number]
    <span class="type">[\x20-\x7E]{1,15}</span>
  </dt>
  <dd>
    Phone number from where the PAN originates.
    <div class="type">Optional</div>
  </dd>
  <dt>mobilepayonline[pares]
    <span class="type">[:base64:]</span>
  </dt>
  <dd>
    See more information at <a target="_blank" href= "http://docs.3dsecure.io">3dsecure.io</a>
    <div class="type">Optional</div>
  </dd>
</dl>

<p class="alert alert-info">
  <b>Notice:</b> Signing is required to use the <code>mobilepayonline</code>
  payment method.
  <br />
  <b>Notice:</b> An authorization made with <code>mobilepayonline</code> is
  strongly authenticated (SCA in PSD2).
</p>

##### Method: `samsungpay`

Samsung Pay provides the payment details as either JWE or JWE/JWS JOSE objects.
Only JWE/JWS is accepted.

The JWE part of JWE/JWS should preferably be encrypted to an RSA key owned
by the PSP, and then a Content Encryption Key is provided in the request.
Alternatively, it can be encrypted using
<a href="clearhaus-samsungpay-public-key.pem">Clearhaus' RSA public key</a>.

<p class="alert alert-info">
<b>Notice:</b> A Samsung Pay authorization encrypted to Clearhaus' RSA private
key, cannot be used for recurring transactions!
</p>

<dl class="dl-vertical">
  <dt>
    samsungpay[jws]
    <span class="type">
      <a href="https://tools.ietf.org/html/rfc7515#page-7">
        Compact serialized JWS token
      </a>
    </span>
  </dt>
  <dd>
    Complete JWE token as received from Samsung Pay.
  </dd>
  <dt>
    samsungpay[ca_cert]
    <span class="type">
      PEM X509 certificate
    </span>
  </dt>
  <dd>
    Device CA certificate signed by Samsung root certificate. Included in
    payment information as <code>certificates.CA</code>.
  </dd>
  <dt>
    samsungpay[verification_cert]
    <span class="type">
      PEM X509 certificate
    </span>
  </dt>
  <dd>
    Device verification certificate signed by <code>ca_cert</code>.
    Included in payment information as <code>certificates.VER</code>.
  </dd>
  <dt>
    samsungpay[cek]
    <span class="type">
      [:base64:]{24}
    </span>
  </dt>
  <dd>
    <div class="type">
      Only if integrator is responsible for decrypting the payload
    </div>
    The 128 bit symmetric AES content encryption key (CEK) used to encrypt the
    payment token, Base64 encoded. This CEK must be extracted from the JWE
    token.
  </dd>
</dl>


### Captures

To transfer money from a cardholder's bank account to your merchant bank
account you make a new capture resource. You can make multiple captures for an
authorization transaction.

````
POST https://gateway.clearhaus.com/authorizations/:id/captures
````

#### Parameters

<dl class="dl-vertical">
  <dt>amount
    <span class="type">[1-9][0-9]{1,9}</span>
  </dt>
  <dd>
    Amount in minor units of given currency (e.g. cents if in Euro).
    The full or remaining amount will be withdrawn if no amount is given.
    <div class="type">Optional</div>
  </dd>
  <dt>text_on_statement
    <span class="type">[\x20-\x7E]{2,22}
      <a target="_blank" href="http://en.wikipedia.org/wiki/ASCII#ASCII_printable_characters">
        ASCII printable characters
      </a>
    </span>
  </dt>
  <dd>
    Text that will be placed on cardholder's bank statement. Overrides <code>text_on_statement</code> from authorization.
    <div class="type">May not be all digits, all same character, or all sequential characters (e.g. "abc")</div>
    <div class="type">Optional</div>
  </dd>
</dl>

<p class="alert alert-info">
<b>Notice:</b> A capture cannot be made if the authorization is 180 days old.
</p>

### Refunds

To refund money to a cardholder's bank account you make a new refund resource.
You can make multiple refunds for an authorization transaction.
#### Parameters

````
POST https://gateway.clearhaus.com/authorizations/:id/refunds
````

<dl class="dl-vertical">
  <dt>amount
    <span class="type">[1-9][0-9]{1,9}</span>
  </dt>
  <dd>
    Amount in minor units of given currency (e.g. cents if in Euro).
    The full or remaining amount will be refunded if no amount is given.
    <div class="type">Optional</div>
  </dd>
  <dt>text_on_statement
    <span class="type">[\x20-\x7E]{2,22}
      <a target="_blank" href="http://en.wikipedia.org/wiki/ASCII#ASCII_printable_characters">
        ASCII printable characters
      </a>
    </span>
  </dt>
  <dd>
    Text that will be placed on cardholder's bank statement. Overrides <code>text_on_statement</code> from authorization.

    <div class="type">May not be all digits, all same character, or all sequential characters (e.g. "abc").</div>
    <div class="type">Optional</div>
  </dd>
</dl>

<p class="alert alert-info">
<b>Notice:</b> A refund does not "free up" what is captured from the
authorization; that is, after authorizing 10, capturing 5 and refunding 5, you
can still only capture 5.
</p>

<p class="alert alert-info">
<b>Notice:</b> A refund cannot be made if the last capture is 180 days old.
</p>


### Voids

To release reserved money on a cardholder's bank account you make a new void
resource. A reservation normally last for 7 days depending on issuing bank and
is then automatically released.

#### Parameters

````
POST https://gateway.clearhaus.com/authorizations/:id/voids
````

No parameters are needed to make a new void transaction.

<p class="alert alert-info">
<b>Notice:</b> A void cannot be made if the authorization age is 30 days or more.
</p>


### Credits

To payout (e.g. winnings and not refunds) money to a cardholder's bank account
you make a new credit resource.

#### Parameters

````
POST https://gateway.clearhaus.com/credits
````

<dl class="dl-vertical">
  <dt>amount
    <span class="type">[1-9][0-9]{1,9}</span>
  </dt>
  <dd>
    Amount in minor units of given currency (e.g. cents if in Euro). As for
    Mastercard, the amount must not exceed the equivalent of 5,000 EUR; as for
    Visa, the amount must not exceed the equivalent of 50,000 USD.
  </dd>
  <dt>currency
    <span class="type">[A-Z]{3}</span>
  </dt>
  <dd>
    <a target="_blank" href="currencies.txt">3-letter currency code</a>. (Some exponents differ from ISO 4217.)
  </dd>
  <dt>text_on_statement
    <span class="type">[\x20-\x7E]{2,22}
      <a target="_blank" href="http://en.wikipedia.org/wiki/ASCII#ASCII_printable_characters">
        ASCII printable characters
      </a>
    </span>
  </dt>
  <dd>
    Text that will be placed on cardholder's bank statement.
    <div class="type">May not be all digits, all same character, or all sequential characters (e.g. "abc").</div>
    <div class="type">Optional</div>
  </dd>
  <dt>reference
    <span class="type">[\x20-\x7E]{1,30} <a target="_blank" href="http://en.wikipedia.org/wiki/ASCII#ASCII_printable_characters">ASCII printable characters</a></span>
  </dt>
  <dd>
    A reference to an external object, such as an order number.
    <div class="type">Optional</div>
  </dd>
  <dt>card[pan]
    <span class="type">[0-9]{12,19}</span>
  </dt>
  <dd>
    Primary account number of card to charge.
  </dd>
  <dt>card[expire_month]
    <span class="type">[0-9]{2}</span>
  </dt>
  <dd>
    Expiry month of card to charge.
  </dd>
  <dt>card[expire_year]
    <span class="type">20[0-9]{2}</span>
  </dt>
  <dd>
    Expiry year of card to charge.
  </dd>
  <dt>card[csc]
    <span class="type">[0-9]{3}</span>
  </dt>
  <dd>
    Card Security Code.
    <div class="type">Optional</div>
  </dd>
  <dt>card[name]
    <span class="type">[A-Za-z0-9 ]{1,30}</span>
  </dt>
  <dd>
    Name on card.
    <div class="type">Optional</div>
  </dd>
</dl>

### Account

The account resource holds basic merchant account information. Only `HTTP GET`
is supported for this endpoint.

````
GET https://gateway.clearhaus.com/account
````


#### Response parameters

<dl class="dl-vertical">
  <dt>merchant_id
    <span class="type">[0-9]{15}</span>
  </dt>
  <dd>
    Used for 3-D Secure and also for reference when talking to our support
    staff. For 3-D Secure it is important to represent this number with leading
    zeros.
  </dd>
  <dt>descriptor
    <span class="type">[\x20-\x7E]{0,22}
      <a target="_blank" href="http://en.wikipedia.org/wiki/ASCII#ASCII_printable_characters">
        ASCII printable characters
      </a>
    </span>
  </dt>
  <dd>
    The default <code>text_on_statement</code>.
  </dd>
  <dt>name
    <span class="type">[\x20-\x7E]{0,20} <a target="_blank" href="http://en.wikipedia.org/wiki/ASCII#ASCII_printable_characters">ASCII printable characters</a></span>
  </dt>
  <dd>
    Merchant company name.
  </dd>
  <dt>country
    <span class="type">[A-Z]{2}</span>
  </dt>
  <dd>
    ISO 3166-1 2-letter country code for merchant company.
  </dd>
  <dt>mcc
    <span class="type">[0-9]{4}</span>
  </dt>
  <dd>
    Merchant category code.
  </dd>
  <dt>acquirer
  </dt>
  <dd>
    Used for 3-D Secure.
  </dd>
  <dt>transaction_rules
    <span class="type">[\x20-\x7E]*</span>
  </dt>
  <dd>
    The processing rules that the merchant's transactions must adhere to.
  </dd>
</dl>


## Transaction status codes

The JSON response will include one of following transaction status codes when
you make a new transaction.

Status     | `code` |  Meaning
---------- | ------ | --------
Approved   |  20000 |  Approved
Declined   |  40000 |  General input error
           |  40110 |  Invalid card number
           |  40111 |  Unsupported card scheme
           |  40120 |  Invalid CSC
           |  40130 |  Invalid expire date
           |  40135 |  Card expired
           |  40140 |  Invalid currency
           |  40150 |  Invalid text on statement
           |  40190 |  Invalid transaction
           |  40200 |  Clearhaus rule violation
           |  40300 |  3-D Secure problem
           |  40310 |  3-D Secure authentication failure
           |  40400 |  Backend problem
           |  40410 |  Declined by issuer or card scheme
           |  40411 |  Card restricted
           |  40412 |  Card lost or stolen
           |  40413 |  Insufficient funds
           |  40414 |  Suspected fraud
           |  40415 |  Amount limit exceeded
           |  40416 |  Additional authentication required
           |  40420 |  Merchant blocked by cardholder
           |  50000 |  Clearhaus error


### Status message

A status message may be included in the response when you create a new
transaction.
The status message can be used for debugging and may include a more specific
error message.

Status messages should be shown to the merchant.

Examples:

````json
{
    "status": {
        "code": 40000,
        "message": "parameter 'amount' is required"
    }
}

{
    "status": {
        "code": 40200,
        "message": "amount > 100 EUR and (not strongly authenticated)"
    }
}

{
    "status": {
        "code": 40200,
        "message": "not (fully 3dsecure or subsequent recurring)"
    }
}
````

### Merchant blocked by cardholder status

A _merchant blocked by cardholder_ status code is both a decline of the current
authorization, but also a notice to **halt all future
merchant-initiated-transactions** on this card from this merchant. This
includes, but is not limited to, recurring transactions.

Only after the blockade has been lifted, by actions taken by the cardholder,
may transactions be resumed.

## Test card numbers

For testing towards the test endpoint `gateway.test.clearhaus.com` please use
PANs that are either <b>not</b>
<a href="https://en.wikipedia.org/wiki/Luhn_algorithm">Luhn-compliant</a>, are
one of the special test PANs 2221000000000009, 4111111111111111,
5500000000000004, or are Apple Pay test cards.

For PANs starting with 420000 and ending with 0000, and PANs starting with
555555 and ending with 4444, you can specify a valid status `code` as
transaction amount to trigger the status.

When testing towards the test endpoint, the CSC 987&mdash;and only 987&mdash;is
considered a match for all PANs.

## Endpoint summary


````shell
# authorizations
https://gateway.clearhaus.com/authorizations

# captures
https://gateway.clearhaus.com/authorizations/:id/captures

# voids
https://gateway.clearhaus.com/authorizations/:id/voids

# refunds
https://gateway.clearhaus.com/authorizations/:id/refunds

# credits
https://gateway.clearhaus.com/credits

# account
https://gateway.clearhaus.com/account
````

## Changes

Follow coming changes on the [source code repository](https://github.com/clearhaus/gateway-api-docs).

Sorted by descending timestamp.

### Optional name on card parameter added

Starting 2020-03-03 the optional parameter `card[name]` may be used to provide
the name on the card for credits. Depending on card scheme and merchant
category, the name might be necessary for approval.

### Request signing becomes mandatory

In the first quarter of 2020 signing of POST requests will become mandatory. We will work together with clients to ensure their requests are compliant before introducing enforcement of the requirement in the transaction gateway.

### Remove deprecated `/cards`, `threed_secure` and `card[number]`

The deprecations announced in 2018 will be executed. Partners must expect
`/cards` endpoints, the `threed_secure` and the `card[number]` parameters to be
unavailable at any point in time after 2019-08-20.
Refer to [the documentation source code
changes](https://github.com/clearhaus/gateway-api-docs/pull/82/files) for the
exact documentation change.

### Add merchant blocked by cardholder status

Starting 2019-04-11 a new status code `40420 - Merchant blocked by cardholder`
is avaliable. Please be advised that appropriate action must be taken to
adequately handle this status code, see [Merchant blocked by cardholder
status](#merchant-blocked-by-cardholder-status)

### Add a valid test CSC

Starting 2019-02-22 the CSC 987 has been added as a valid CSC for all PANs when
testing against `gateway.test.clearhaus.com`.

[JSON-HAL]: http://tools.ietf.org/html/draft-kelly-json-hal "IETF HAL draft"
[HATEOAS]: http://en.wikipedia.org/wiki/HATEOAS
[Tokenization]: http://en.wikipedia.org/wiki/Tokenization_(data_security)
[ApplePay-PaymentToken]: https://developer.apple.com/library/content/documentation/PassKit/Reference/PaymentTokenJSON/PaymentTokenJSON.html
